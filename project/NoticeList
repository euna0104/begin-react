import React, { useState, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';
import CommonTable from '.././Component/CommonTable';
import CommonTableColumn from '.././Component/CommonTableColumn';
import CommonTableRow from '.././Component/CommonTableRow';

const NoticeList = () => {
  const [dataList, setDataList] = useState([]);
  const accessToken = sessionStorage.getItem('accessToken');
  const navigate = useNavigate();

  async function fetchNoticeBoards() {
    try {
      const response = await axios.get('/api/noticeboards', {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
        params: {
          page: 1,
          count: 3,
        },
      });

      console.log('데이터 가져오기 성공:', response.data);

      // 가져온 데이터를 반환
      return response.data;
    } catch (error) {
      // 오류 발생 시 처리할 부분
      console.error('데이터 가져오기 실패:', error);

      // 오류 상황
      throw error;
    }
  }

  useEffect(() => {
    fetchNoticeBoards()
      .then((data) => {
        // 데이터를 가져왔을 때 수행할 작업을 이곳에 추가하세요.
        setDataList(data); // 가져온 데이터를 상태로 설정
      })
      .catch((error) => {
        // 오류 발생 시 수행할 작업을 이곳에 추가하세요.
        console.error('데이터 가져오기 오류:', error);
      });
  }, []); // useEffect를 사용하여 컴포넌트가 처음 렌더링될 때만 데이터를 불러오도록 설정

  return (
    <>
      <CommonTable headersName={['글번호', '제목', '등록일', '조회수']}>
        {dataList ? dataList.map((dataList, index) => (
          <CommonTableRow key={index}>
            <CommonTableColumn>{dataList.no}</CommonTableColumn>
            <CommonTableColumn>
              <span
                onClick={() => {
                  navigate(`/api/noticeboards/${dataList.no}`);
                }}
                style={{ textDecoration: 'underline', cursor: 'pointer' }}
              >
                {dataList.title}
              </span>
            </CommonTableColumn>
            <CommonTableColumn>{dataList.createData}</CommonTableColumn>
            <CommonTableColumn>{dataList.readCount}</CommonTableColumn>
          </CommonTableRow>
        )) : ''}
      </CommonTable>
    </>
  )
};

export default NoticeList;
