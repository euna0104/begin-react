import React, { useState, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';
import CommonTable from '.././Component/CommonTable';
import CommonTableColumn from '.././Component/CommonTableColumn';
import CommonTableRow from '.././Component/CommonTableRow';
import Header from '.././Header';

const NoticeList = () => {
  const [dataList, setDataList] = useState([]);
  const accessToken = sessionStorage.getItem('accessToken');
  const navigate = useNavigate();

  useEffect(() => {
    async function fetchNoticeBoards() {
      try {
        const response = await axios.get('/api/noticeboards', {
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
          params: {
            page: 1,
            count: 3,
          },
        });

        console.log('데이터 가져오기 성공:', response.data);

        // 가져온 데이터를 상태로 설정
        setDataList(response.data.noticeBoards);
      } catch (error) {
        // 오류 발생 시 처리
        console.error('데이터 가져오기 오류:', error);
        // 오류 상황에 따라 에러 메시지를 출력하거나 다른 작업 수행
      }
    }

    fetchNoticeBoards();
  }, [accessToken]);

  return (
    <>
      <Header />
      <CommonTable headersName={['글번호', '제목', '등록일', '조회수']}>
        {Array.isArray(dataList) && dataList.length > 0 ? (
          dataList.map((data, index) => (
            <CommonTableRow key={index}>
              <CommonTableColumn>{data.id}</CommonTableColumn>
              <CommonTableColumn>
                <span
                  onClick={() => {
                    navigate(`/api/noticeboards/title${data.id}`);
                  }}
                  style={{ textDecoration: 'underline', cursor: 'pointer' }}
                >
                  {data.title}
                </span>
              </CommonTableColumn>
              <CommonTableColumn>{data.createDate}</CommonTableColumn>
              <CommonTableColumn>{data.views}</CommonTableColumn>
            </CommonTableRow>
          ))
        ) : (
          <div>No data available</div>
        )}
      </CommonTable>
    </>
  );
};

export default NoticeList;
